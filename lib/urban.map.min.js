(function(){var t,n,e;e=function(t){throw"Urban Map Error : "+t};t=function(){function t(t){var n,i,o,r,a,l,s;r=this;if(t==null){t={}}o=["geoJson","csv","colors","countyID","displayVariable","renderTo"];for(a=0,l=o.length;a<l;a++){i=o[a];if(n=t[i]){r[i]=n}else{e('"'+i+'" not provided to Map.')}}this.tooltip=(s=t.tooltip)!=null?s:{formatter:function(){},opacity:0};d3.json(t.geoJson,function(t,n){r.countyJson=n;return r.loadCSV(r.csv,function(){r.render();return r.update(r.displayVariable)})})}t.prototype.loadCSV=function(t,n){var i,o;o=this;i=o.countyID;d3.csv(t,function(t,r){var a,l,s,u;o.data=a={};for(s=0,u=r.length;s<u;s++){l=r[s];if(!(i in l)){e(""+i+" not in csv!")}a[l[i]]=l}return n()});return o};t.prototype.render=function(){var t,n,e,i,o,r,a,l,s,u,d,c;l=this;c=this.width=1011;e=this.hieght=588;r=d3.geo.albersUsa().scale(c).translate([c/2,e/2]);o=d3.geo.path().projection(r);a=d3.select(this.renderTo);s=a.html("").append("svg").attr({"class":"urban-map",preserveAspectRatio:"xMinYMin slice",viewBox:"0 0 "+c+" "+e}).append("g");this.legend=s.append("g").attr({"class":"urban-map-legend"});d=topojson.feature(this.countyJson,this.countyJson.objects.counties).features;u=d3.select("body").append("div").attr("class","urban-map-tooltip").style({display:"block",position:"absolute",opacity:0});d3.select("body").on("mousemove",function(){var t,n,e,i;i=[d3.event.pageX,d3.event.pageY],n=i[0],e=i[1];t=u.node().getBoundingClientRect();return u.style({top:""+(e-t.height-10)+"px",left:""+(n-t.width/2)+"px"})});t=l.data;n=l.tooltip.formatter;i=l.tooltip.opacity;this.counties=s.append("g").selectAll("path").data(d).enter().append("path").attr("class","urban-map-counties").attr("id",function(t){return t.id}).attr("d",o).on("mouseover",function(){var e;e=this.id in t?t[this.id]:{};return u.html(n.call(e)).transition().duration(100).style({opacity:i})}).on("mouseout",function(){return u.transition().duration(100).style({opacity:0})});return l};t.prototype.update=function(t){var n,i,o,r,a,l,s,u,d,c,h,p,f,v,g,b,y,m,w,x,M,J,j,A,V,C;p=this;o=this.bins=(v=(g=t.breaks)!=null?g:this.bins)!=null?v:e("No bins provided!");h=(w=t.name)!=null?w:e("No variable name provided!");s=this.colors=(x=t.colors)!=null?x:this.colors;c=this.fmt=(M=(J=(j=t.legend)!=null?j.formatter:void 0)!=null?J:this.fmt)!=null?M:function(){return this.value};i=this.binWidth=(A=(V=(C=t.legend)!=null?C.binWidth:void 0)!=null?V:this.binWidth)!=null?A:40;u=this.enable=(b=(y=(m=t.legend)!=null?m.enabled:void 0)!=null?y:this.enabled)!=null?b:true;n=o.length;r=s.length;if(n>r){throw""+(n-r)+" more bins than colors!"}if(n<r){throw""+(r-n)+" more colors than bins!"}l=d3.scale.threshold().domain(o).range(s);this.legend.empty();if(u){a=(this.width-i*o.length)/2;this.legend.selectAll("rect").data(o).enter().append("rect").attr({width:i,height:i*.5,x:function(t,n){return a+n*i},y:50}).style({fill:function(t){return l(t*.99)}});this.legend.selectAll("text").data(o.slice(0,-1)).enter().append("text").text(function(t){return c.call({value:t})}).attr({y:40,x:function(t,n){return a+(n+1)*i-i/3}})}d=function(t){var n,e;return l((n=(e=p.data[t.id])!=null?e[h]:void 0)!=null?n:"#aaa")};if(f=t.transition){this.counties.transition().duration(Math.abs(f)).attr("fill",d)}else{this.counties.attr("fill",d)}return p};return t}();n=n||{};(function(){n.Map=t;return window.Urban=n})()}).call(this);