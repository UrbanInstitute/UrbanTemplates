(function(){var t,n,e;e=function(t){throw"Urban Map Error : "+t};t=function(){function t(t){var n,o,i,a,r,l,s;a=this;if(t==null){t={}}i=["geoJson","csv","colors","countyID","displayVariable","renderTo"];for(r=0,l=i.length;r<l;r++){o=i[r];if(n=t[o]){a[o]=n}else{e('"'+o+'" not provided to Map.')}}this.tooltip=(s=t.tooltip)!=null?s:{formatter:function(){},opacity:0};d3.json(t.geoJson,function(t,n){a.countyJson=n;return a.loadCSV(a.csv,function(){a.render();return a.update(a.displayVariable)})})}t.prototype.loadCSV=function(t,n){var o,i;i=this;o=i.countyID;d3.csv(t,function(t,a){var r,l,s,u;i.data=r={};for(s=0,u=a.length;s<u;s++){l=a[s];if(!(o in l)){e(""+o+" not in csv!")}r[l[o]]=l}return n()});return i};t.prototype.render=function(){var t,n,e,o,i,a,r,l,s,u,d,c,h;l=this;h=this.width=1011;e=this.hieght=588;a=d3.geo.albersUsa().scale(h).translate([h/2,e/2]);i=d3.geo.path().projection(a);r=d3.select(this.renderTo);u=r.html("").append("svg").attr({"class":"urban-map",preserveAspectRatio:"xMinYMin slice",viewBox:"0 0 "+h+" "+e}).append("g");this.legend=u.append("g").attr({"class":"urban-map-legend"});c=topojson.feature(this.countyJson,this.countyJson.objects.counties).features;s=topojson.mesh(this.countyJson,this.countyJson.objects.states,function(t,n){return t!==n});d=d3.select("body").append("div").attr("class","urban-map-tooltip").style({display:"block",position:"absolute",opacity:0});d3.select("body").on("mousemove",function(){var t,n,e,o;o=[d3.event.pageX,d3.event.pageY],n=o[0],e=o[1];t=d.node().getBoundingClientRect();return d.style({top:""+(e-t.height-10)+"px",left:""+(n-t.width/2)+"px"})});t=l.data;n=l.tooltip.formatter;o=l.tooltip.opacity;this.counties=u.append("g").selectAll("path").data(c).enter().append("path").attr("class","urban-map-counties").attr("id",function(t){return t.id}).attr("d",i).on("mouseover",function(){var e;e=this.id in t?t[this.id]:{};return d.html(n.call(e)).transition().duration(100).style({opacity:o})}).on("mouseout",function(){return d.transition().duration(100).style({opacity:0})});u.append("path").datum(s).attr("class","urban-map-states").attr("d",i).style({fill:"none"});return l};t.prototype.update=function(t){var n,o,i,a,r,l,s,u,d,c,h,p,f,v,b,g,y,m,w,x,J,j,M,A,V,C;p=this;i=this.bins=(v=(b=t.breaks)!=null?b:this.bins)!=null?v:e("No bins provided!");h=(w=t.name)!=null?w:e("No variable name provided!");s=this.colors=(x=t.colors)!=null?x:this.colors;c=this.fmt=(J=(j=(M=t.legend)!=null?M.formatter:void 0)!=null?j:this.fmt)!=null?J:function(){return this.value};o=this.binWidth=(A=(V=(C=t.legend)!=null?C.binWidth:void 0)!=null?V:this.binWidth)!=null?A:40;u=this.enable=(g=(y=(m=t.legend)!=null?m.enabled:void 0)!=null?y:this.enabled)!=null?g:true;n=i.length;a=s.length;if(n>a){throw""+(n-a)+" more bins than colors!"}if(n<a){throw""+(a-n)+" more colors than bins!"}l=d3.scale.threshold().domain(i).range(s);this.legend.empty();if(u){r=(this.width-o*i.length)/2;this.legend.selectAll("rect").data(i).enter().append("rect").attr({width:o,height:o*.5,x:function(t,n){return r+n*o},y:50}).style({fill:function(t){return l(t*.99)}});this.legend.selectAll("text").data(i.slice(0,-1)).enter().append("text").text(function(t){return c.call({value:t})}).attr({y:40,x:function(t,n){return r+(n+1)*o-o/3}})}d=function(t){var n,e;return l((n=(e=p.data[t.id])!=null?e[h]:void 0)!=null?n:"#aaa")};if(f=t.transition){this.counties.transition().duration(Math.abs(f)).attr("fill",d)}else{this.counties.attr("fill",d)}return p};return t}();n=n||{};(function(){n.Map=t;return window.Urban=n})()}).call(this);