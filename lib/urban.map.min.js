(function(){var t,n,o;o=function(t){throw"Urban Map Error : "+t};t=function(){function t(t){var n,e,i,r,a,s,l;r=this;if(t==null){t={}}i=["geoJson","csv","colors","countyID","displayVariable","renderTo"];for(a=0,s=i.length;a<s;a++){e=i[a];if(n=t[e]){r[e]=n}else{o('"'+e+'" not provided to Map.')}}this.tooltip=(l=t.tooltip)!=null?l:{formatter:function(){},opacity:0};d3.json(t.geoJson,function(t,n){r.countyJson=n;return r.loadCSV(r.csv,function(){r.render();return r.update(r.displayVariable)})})}t.prototype.loadCSV=function(t,n){var e,i;i=this;e=i.countyID;d3.csv(t,function(t,r){var a,s,l,u;i.data=a={};for(l=0,u=r.length;l<u;l++){s=r[l];if(!(e in s)){o(""+e+" not in csv!")}a[s[e]]=s}return n()});return i};t.prototype.render=function(){var t,n,o,e,i,r,a,s,l,u,c,d;s=this;d=1011;o=588;r=d3.geo.albersUsa().scale(d).translate([d/2,o/2]);i=d3.geo.path().projection(r);a=d3.select(this.renderTo);l=a.html("").append("svg").attr({"class":"urban-map",preserveAspectRatio:"xMinYMin slice",viewBox:"0 0 "+d+" "+o}).append("g");c=topojson.feature(this.countyJson,this.countyJson.objects.counties).features;u=d3.select("body").append("div").attr("class","urban-map-tooltip").style({display:"block",position:"absolute",opacity:0});d3.select("body").on("mousemove",function(){var t,n,o,e;e=[d3.event.pageX,d3.event.pageY],n=e[0],o=e[1];t=u.node().getBoundingClientRect();return u.style({top:""+(o-t.height-10)+"px",left:""+(n-t.width/2)+"px"})});t=s.data;n=s.tooltip.formatter;e=s.tooltip.opacity;this.counties=l.append("g").selectAll("path").data(c).enter().append("path").attr("class","urban-map-counties").attr("id",function(t){return t.id}).attr("d",i).on("mouseover",function(){var o;o=this.id in t?t[this.id]:{};return u.html(n.call(o)).transition().duration(100).style({opacity:e})}).on("mouseout",function(){return u.transition().duration(100).style({opacity:0})});return s};t.prototype.update=function(t){var n,e,i,r,a,s,l,u,c,d,p;l=this;e=this.bins=(c=(d=t.breaks)!=null?d:this.bins)!=null?c:o("No bins provided!");this.colors=(p=t.colors)!=null?p:this.colors;s=t.name;n=e.length;i=this.colors.length;if(n>i){throw""+(n-i)+" more bins than colors!"}if(n<i){throw""+(i-n)+" more colors than bins!"}r=d3.scale.threshold().domain(e).range(this.colors);a=function(t){var n,o;return r((n=(o=l.data[t.id])!=null?o[s]:void 0)!=null?n:"#aaa")};if(u=t.transition){this.counties.transition().duration(Math.abs(u)).attr("fill",a)}else{this.counties.attr("fill",a)}return l};return t}();n=n||{};(function(){n.Map=t;return window.Urban=n})()}).call(this);